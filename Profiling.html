<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RAMSES Documentation: Performance and profiling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ramses_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RAMSES Documentation
   &#160;<span id="projectnumber">27.0.128</span>
   </div>
   <div id="projectbrief">Information for RAMSES users and developers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Performance and profiling </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md200"></a>
Overview</h1>
<p>There are multiple ways to find bottlenecks in your assets, your code using Ramses, or Ramses itself.</p>
<h1><a class="anchor" id="autotoc_md201"></a>
Inspecting the contents of your scene and optimizing it</h1>
<p>The first source of performance problems in a 3D application is usually the content. Having large textures or geometry, heavy shaders, or simply rendering suboptimally - those are all things that can be easily solved in the content/scene directly by a skilled technical artist.</p>
<p>Ramses provides a tool to perform such analysis, called the ramses scene viewer (see its documentation in <a class="el" href="SceneViewer.html">ramses-scene-viewer</a>).</p>
<h1><a class="anchor" id="autotoc_md202"></a>
Looking at the Ramses periodic performance logs</h1>
<p>A great source of information about what's going on in the Ramses threads (specifically when having network involved) are the ramses periodic logs (RPER). See below how to read and use these logs.</p>
<h2><a class="anchor" id="autotoc_md203"></a>
General periodic logs</h2>
<p>Any Ramses application (regardless if it has a client, a renderer, or both) has a periodic log whichs looks like this: </p><pre class="fragment">20210212-16:33:50.770 | Info  | RPER | Version: 27.0.6 Hash:cca2a0b60f Commit:28143 Type:Release Env:(unknown) SyncT:1613144030770ms (dtSteady:2023 - dtSync:2023 -&gt; 0) PUp:31679 RUp:31575 RInit:1 RParallel:1
20210212-16:33:50.775 | Info  | RPER | Connected Participant(s): 00000000-0000-0000-0000-000000000003, 00000000-0000-0000-0000-000000000004, 00000000-0000-0000-0000-000000000002, 00000000-0000-0000-0000-000000000005
20210212-16:33:50.775 | Info  | RPER | Dcsm(7AB1-B4A4D03AA15F) C LP:false LC:false CP[] C[]
</pre><p> First line:</p><ul>
<li>Ramses version, commithash, commit no, build type</li>
<li>RInit: 1 instance of ramses initialized (framework)</li>
<li>RParallel: 1 instance of ramses running now</li>
</ul>
<p>Second line: Participants connected to this instance of ramses</p>
<p>Third line: Dcsm related stats</p>
<h2><a class="anchor" id="autotoc_md204"></a>
Client periodic logs</h2>
<p>A Ramses client typically reports logs like this: </p><pre class="fragment">20210212-16:33:50.778 | Info  | RPER | Client: 1 scene(s): 123 Subscribed
20210212-16:33:50.778 | Info  | RPER | msgIn (0) msgO (0) res+ (27/32/29) res- (0) resNr (218/245/231) resF (0) resFS (0)
20210212-16:33:50.782 | Info  | RPER | scene: 123 flush (60/61/60) obj+ (50/75/62) obj- (0) objNr (2670/2720/2695) actG (1560/1671/1615) actGS (30988/33020/32004) actO (1560/1671/1615) actSkp (0) ar# (173/197/185) aras (53460/54325/53892) arms (408272) er# (11) eras (1241) erms (2388) tr# (19/20/19) tras (1099739/1114657/1107198) trms (2097144)
</pre><p>The client-side periodic logger collects the stats values (flush, obj+, etc) every second. However the time interval for logging output is configurable and by default set to 2 seconds.</p>
<p>The collected values are printed in two fashions depending on the stat value:</p><ul>
<li><code>suX</code> lists the largest collected values of the last logging period (value1, value2, ..., valueN)</li>
<li>For all other stats there are typically 3 values printed (min/max/avg): -* min: the smallest value that was collected since the last log output -* max: the largest value that was collected since the last log output -* avg: the average of all collected values since the last log output: ((value1 + value2 + ..valueN) / n)</li>
</ul>
<p>If the smallest and the largest value are equal (min == max), only 1 value will be printed: (value)</p>
<p>Examples:</p>
<ul>
<li>Time interval is set to 4 seconds. The logger collected 4 values: 20, 25, 21, 55; Logs will print: (20/55/30)</li>
<li>Time interval is set to 2 seconds, the logger collected 2 values: 42, 42; Logs will print (42)</li>
</ul>
<p>The logs explained line by line:</p>
<p>First line:</p><ul>
<li>Client participant id</li>
<li>List of scenes owned by the client and their status</li>
</ul>
<p>Second line (General client performance stats):</p>
<ul>
<li>msgIn: Number of messages received</li>
<li>msgO: Number of message sent</li>
<li>res+: Client Resources created</li>
<li>res-: Client Resources destroyed</li>
<li>resNr: Client Resource Count</li>
<li>resF: Number of Client Resources loaded from File</li>
<li>resFS: Size of Client Resources loaded from file</li>
</ul>
<p>Third line and over (Scene related stats):</p>
<ul>
<li>scene: scene id</li>
<li>flush: Number of flushes triggered per second</li>
<li>obj+: Number of scene objects created (<a class="el" href="classramses_1_1SceneObject.html" title="The SceneObject is a base class for all client API objects owned by a Scene.">ramses::SceneObject</a>) per second</li>
<li>obj-: Number of scene objects destroyed (<a class="el" href="classramses_1_1SceneObject.html" title="The SceneObject is a base class for all client API objects owned by a Scene.">ramses::SceneObject</a>) per second</li>
<li>objNr: Number of currently existing scene objects (<a class="el" href="classramses_1_1SceneObject.html" title="The SceneObject is a base class for all client API objects owned by a Scene.">ramses::SceneObject</a>)</li>
<li>actG: Number of scene actions generated per second</li>
<li>actGS: Size of scene actions generated per second</li>
<li>actO: Number of scene actions sent to renderer(s) per second (will be counted for each scene subscriber)</li>
<li>actSkp: Number of skipped scene actions per second (usually an optimization to avoid empty updates)</li>
<li>suG: Scene updates generated per second. Number of scene update packages generated for network send (might be more than # of sceneupdates)</li>
<li>suGS: Scene update generated size per second. Accumulated size of scene update packages generated for network send</li>
<li>suX: The size of the largest scene update package within 1 second</li>
<li>ar#: Number of currently used array resources</li>
<li>aras: Average size of a single array resource ((totalSize of currently used array resources) / ar#)</li>
<li>arms: Largest currently used array resource</li>
<li>er#: Number of currently used Effects</li>
<li>eras: Average size of a single effect resource ((totalSize of currently used effects) / er#)</li>
<li>erms: Largest currently used effect resource</li>
<li>tr#: Number of currently used texture resources</li>
<li>tras: Average size of a single texture resource ((totalSize of currently used textures) / tr#)</li>
<li>trms: Largest currently used texture resource</li>
</ul>
<p>Caveats:</p>
<p>Some stats describe changes/deltas to the scene: flush, obj+, obj-, act*, su* - others describe a snapshot of the current scene state: objNr, ar*, er* tr* Resource stats (ar*,er*, tr*) are only logged if there was a flush during the logging interval</p>
<h2><a class="anchor" id="autotoc_md205"></a>
Renderer periodic logs</h2>
<p>A Ramses application which also contains a renderer component has periodic logs which look like this: </p><pre class="fragment">20210212-16:33:48.791 | Info  | RPER | Renderer: 1 scene(s): 123 Rendered
Avg framerate: 52.63158 FPS [minFrameTime 381us, maxFrameTime 59404us], drawcallsPerFrame 35, numFrames 107, resUploaded 128 (13207530 B)
FB0: 92
Scene 123: rendered 92, framesFArrived 92, framesFApplied 92, framesFBlocked 0, maxFramesWithNoFApplied 3, maxFramesFBlocked 0, FArrived 1397, FApplied 1397, actions/F (10/215/20.180386), dt/F (1/21295/34.343594), RC+/F (0/28/0.09234073), RC-/F (0/28/0.09520401), RS/F (0/0/0)
Time budgets: sceneResourceUpload 315360000000000us resourceUpload 315360000000000us obRender 315360000000000us
Longest frame(us)[avg]:59190 RendererCommands:749 [387] UpdateClientResources:32 [372] ApplySceneActions:7841 [2781] UpdateSceneResources:159 [114] UpdateEmbeddedCompositingResources:14 [8] UpdateStreamTextures:10 [5] UpdateScenesToBeMapped:13 [8] UpdateResourceCache:1039 [3234] UpdateAnimations:8 [5] UpdateTransformations:290 [138] UpdateDataLinks:44 [26] HandleDisplayEvents:34 [316] DrawScenes:1908 [1393] SwapBuffersNotifyClients:47049 [6854] MaxFramerateSleep:0 [2870]
</pre><p> Read these logs like this:</p>
<p>First line:</p><ul>
<li>Renderer participant id</li>
<li>List of scenes known to renderer and status</li>
</ul>
<p>Second line (General renderer performance stats):</p><ul>
<li>Number of frames per second</li>
<li>minimal and maximal frame time within time period</li>
<li>drawcalls per frame</li>
<li>Number of frames rendered in time period</li>
<li>resources uploaded in time period</li>
</ul>
<p>Third line and over(scene related stats):</p><ul>
<li>Scene id</li>
<li>rendered: Number of frames rendered</li>
<li>FrameFArrived: Number of frames where flushes arrived</li>
<li>FramesFApplied: Number of frames where flushes applied</li>
<li>FrameFBlocked: Number of frames where applying a flush was blocked</li>
<li>maxFramesWithNoFApplied: How many consecutive frame there was no flush applied</li>
<li>maxFramesFBlocked: How many consecutive frames flushes were blocked from applying</li>
<li>FArrived: Number of flushes arrived</li>
<li>FApplied: Number of flushes applied</li>
<li>actions/F: number of scene actions per flush</li>
<li>dt/F: flush latency</li>
<li>RC+/F RC-/F: Number of client resources added/removed per flush</li>
<li>RS/F: Number of scene resource actions per flush</li>
<li>RSUploaded: Size of scene resources uploaded</li>
</ul>
<p>Time budgets: Information about how much time per frame an action may take as a maximum, set by application</p>
<p>Advanced stats:</p><ul>
<li>Longest Frame: How long did the longest frame take to render alltogether</li>
<li>Rest: Advanced stats for profiling renderer which need internal understanding of the Ramses renderer.</li>
</ul>
<h1><a class="anchor" id="autotoc_md206"></a>
Using specialized tools</h1>
<p>If the above methods didn't yield the results you expected, or you still think your application can perform better, you can also use some of the professional tools for profiling:</p>
<ul>
<li>NVidia NSight - a great tool by NVidia which can analyze any OpenGL-based application. Limitation: requires an NVidia graphics card.</li>
<li>Standard profilers like the MSVC Profiler or gprof - great for finding CPU bottlenecks or memory attrition issues.</li>
<li>Android Profiler - a great all-round tool for finding issues, also in native libs such as Ramses. Works only on Android. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
