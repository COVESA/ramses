#  -------------------------------------------------------------------------
#  Copyright (C) 2020 BMW AG
#  -------------------------------------------------------------------------
#  This Source Code Form is subject to the terms of the Mozilla Public
#  License, v. 2.0. If a copy of the MPL was not distributed with this
#  file, You can obtain one at https://mozilla.org/MPL/2.0/.
#  -------------------------------------------------------------------------

---
- project:
    check:
      jobs:
        # only checking orga stuff, no build
        - rlogic-checker
        - rlogic-linux-clang-tidy
        - rlogic-linux-llvm-64-debug
        - rlogic-windows-msvc2017-release
        - rlogic-build-and-push-docker-image

    gate:
      jobs:
        # only checking orga stuff, no build
        - rlogic-checker
        - rlogic-linux-llvm-64-release
        - rlogic-linux-llvm-64-headless
        - rlogic-windows-msvc2017-debug
        - rlogic-windows-msvc2017-release

        - rlogic-build-and-push-docker-image

        - rlogic-linux-thread-sanitizer-64-debug
        - rlogic-linux-gcc-64-debug
        - rlogic-linux-gcc-64-release
        - rlogic-linux-valgrind-64
        - rlogic-linux-clang-tidy
        - rlogic-linux-verify-flatbuffers-gen-files
        - rlogic-linux-address-sanitizer-64-debug
        - rlogic-linux-ub-sanitizer-64-debug
        - rlogic-linux-gcc-64-lto-release
        - rlogic-linux-llvm-64-debug-shuffled

        - rlogic-mgu22-release

        # OSS builds
        - rlogic-linux-gcc-64-release-oss
        - rlogic-windows-msvc2017-release-oss

    test:
      jobs:
        - rlogic-checker
        - rlogic-linux-llvm-64-release
        - rlogic-linux-llvm-64-headless
        - rlogic-windows-msvc2017-debug
        - rlogic-windows-msvc2017-release

        - rlogic-build-and-push-docker-image

        - rlogic-linux-thread-sanitizer-64-debug
        - rlogic-linux-gcc-64-debug
        - rlogic-linux-gcc-64-release
        - rlogic-linux-valgrind-64
        - rlogic-linux-clang-tidy
        - rlogic-linux-verify-flatbuffers-gen-files
        - rlogic-linux-address-sanitizer-64-debug
        - rlogic-linux-ub-sanitizer-64-debug
        - rlogic-linux-gcc-64-lto-release
        - rlogic-linux-llvm-64-debug-shuffled

        # OSS builds
        - rlogic-linux-gcc-64-release-oss
        - rlogic-windows-msvc2017-release-oss

    post:
      jobs:
        # need noop job to avoid error when all jobs are filtered out
        - noop
        - rlogic-tag-docker-images
        # Don't rename this!! This job is defined outside of the project
        - trigger-image-build-ramses-ubuntu1804:
            dependencies:
              - rlogic-tag-docker-images
            # This filter ensures that docker images are only updated when the source files changed
            # This filter **must** be the same as the one defined in rlogic-tag-docker-images (in 02_jobs.yaml)
            files:
              - ci/docker/image/.*

    release:
      jobs:
        - rlogic-release-on-tag
