#  -------------------------------------------------------------------------
#  Copyright (C) 2020 BMW AG
#  -------------------------------------------------------------------------
#  This Source Code Form is subject to the terms of the Mozilla Public
#  License, v. 2.0. If a copy of the MPL was not distributed with this
#  file, You can obtain one at https://mozilla.org/MPL/2.0/.
#  -------------------------------------------------------------------------

---
- job:
    name: rlogic-base
    parent: ramses-login
    required-projects:
      - name: ramses/external-googletest
        override-checkout: v1.11.0-with-fixes
      - name: ramses/external-lua
        override-checkout: v5.1.1_with_fixes2
      - name: ramses/external-google-benchmarks
        override-checkout: v1.5.2-with-fixes
      - name: ramses/external-sol
        override-checkout: v3.2.2_release_with_fixes3
      - name: ramses/external-flatbuffers
        override-checkout: v1.12.0_with_fixes
      - name: ramses/external-fmt
        override-checkout: 7.1.3
      - name: ramses/external-glslang
        override-checkout: github_release_8.13.3743_with_fixes
      - name: ramses/external-freetype
        override-checkout: 2_9_0_with_ramses_fixes2
      - name: ramses/external-harfbuzz
        override-checkout: release_1.7.5_with_ramses_fixes4
      - name: ramses/external-lz4
        override-checkout: v1_7_5
      - name: ramses/external-fmt
        override-checkout: v6.1.2_fix2
      - name: ramses/external-asio
        override-checkout: release-1-14-0_fixes
      - name: ramses/external-abseil
        override-checkout: lts_2019_08_08_fixed_2
      - name: ramses/external-imgui
        override-checkout: v1.74_ramsesfixes
      - name: ramses/external-CLI11
        override-checkout: release-2.2.0
      - name: ramses/ramses-sdk
        override-checkout: 27.0.130
      - name: ramses/ramses-oss
        override-checkout: 27.0.130
      - name: ramses/ramses-logic-oss
      - name: ramses/ramses-logic
    timeout: 3600  # 1 hour
    vars:
      # Configure cilib
      enable_repo_sync: true
      enable_apt_mirror: true
      enable_cilib_python: true
      # Used by other playbooks in ramses logic
      log_dir: "{{ zuul_logs_dir }}"
      github_url: https://cc-github.bmwgroup.net/
      cache_repository: ramses-generic/ci-cache
      cache_namespace: ramses-logic/{{ zuul.buildset }}
      rlogic_venv: "{{ ansible_user_dir }}/rlogic_venv"

- job:
    name: rlogic-linux-base
    parent: rlogic-base
    nodeset:
      nodes:
        - name: ramses-linux-node
          label: ramses-ubuntu1804-8-core
    pre-run: ci/playbooks/prepare-linux.yaml
    post-run: ci/playbooks/collect-build-results-linux.yaml
    vars:
      buildslave_root_dir: /home/zuul

- job:
    name: rlogic-linux-base-small
    parent: rlogic-base
    nodeset:
      nodes:
        - name: ramses-linux-node
          label: ramses-ubuntu1804-2-core
    pre-run: ci/playbooks/prepare-linux.yaml
    vars:
      buildslave_root_dir: /home/zuul

- job:
    name: rlogic-windows-compile-base
    parent: rlogic-base
    nodeset:
      nodes:
        - name: ramses-windows-node
          label: ramses-windows2019-8-core
    post-run: ci/playbooks/collect-build-results-windows.yaml
    timeout: 5400  # 1.5 hours
    vars:
      dest_workspace: C:\ws  # variable needed for windows cilib base jobs
      buildslave_root_dir: "{{dest_workspace}}"
      win_synchronize_ssh: false
